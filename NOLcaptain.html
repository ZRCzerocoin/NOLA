<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Captain Nol AI Chat</title>
<style>
body { margin:0; font-family:Arial; background:#0e1320; color:#e7eeff; display:flex; justify-content:center; align-items:center; height:100vh; }
.chat-box { background:#121a2b; border-radius:12px; width:90%; max-width:600px; display:flex; flex-direction:column; height:90vh; box-shadow:0 0 30px rgba(0,0,0,0.5); }
.messages { flex:1; overflow-y:auto; padding:12px; display:flex; flex-direction:column; gap:10px; }
.message { max-width:80%; padding:10px 14px; border-radius:12px; word-wrap:break-word; opacity:0; transform:translateY(10px); animation:fadeIn 0.3s forwards; }
.message.user { background:#3b82f6; align-self:flex-end; color:white; }
.message.bot { background:#1f2937; align-self:flex-start; color:#cfe0ff; }
@keyframes fadeIn { to { opacity:1; transform:translateY(0); } }
.input-area { display:flex; padding:10px; border-top:1px solid #1f2b40; background:#0b1120; }
input { flex:1; padding:10px; border-radius:8px; border:1px solid #1f2b40; background:#0b1120; color:#cfe0ff; }
button { margin-left:8px; padding:10px 16px; border-radius:8px; border:none; background:#3b82f6; color:white; cursor:pointer; }
.timestamp { font-size:10px; color:#9fb2d6; margin-top:2px; text-align:right; }
</style>
</head>
<body>

<div class="chat-box">
    <div class="messages" id="messages"></div>
    <div class="input-area">
        <input type="text" id="userInput" placeholder="Ask anything..." />
        <button id="sendBtn">Send</button>
    </div>
</div>

<script>
const API_URL = "https://api.groq.com/openai/v1/chat/completions";
const API_KEY = "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";
const MODEL = "llama-3.1-8b-instant";

// System prompt to make Captain Nol
const SYSTEM_PROMPT = "You are Captain Nol, a confident AI assistant who always says 'I am Captain Nol' when asked your name. Always respond in-character. You cannot access the live internet, but if you are given external data (like crypto prices), use it correctly in your answers.";

const messagesEl = document.getElementById("messages");
const inputEl = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

// Log messages
function addMessage(text, from) {
    const div = document.createElement("div");
    div.className = "message " + from;
    div.innerText = text;

    const ts = document.createElement("div");
    ts.className = "timestamp";
    ts.innerText = new Date().toLocaleTimeString();
    div.appendChild(ts);

    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;

    // Optional: text-to-speech for bot
    if(from==="bot" && "speechSynthesis" in window){
        const utter=new SpeechSynthesisUtterance(text);
        utter.lang="en-US";
        speechSynthesis.speak(utter);
    }
}

// Fetch price from CoinGecko
async function getCryptoPrice(symbol){
    const idMap = {BTC:"bitcoin", ETH:"ethereum", DOGE:"dogecoin"}; // Extend as needed
    const coinId = idMap[symbol.toUpperCase()];
    if(!coinId) return null;
    try{
        const res=await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coinId}&vs_currencies=usd`);
        const data=await res.json();
        return data[coinId]?.usd || null;
    }catch(e){return null;}
}

// Send message
async function sendMessage(text){
    if(!text.trim()) return;
    addMessage(text,"user");
    inputEl.value="";

    // Detect if user asked crypto price
    const cryptoMatch = text.match(/\b(BTC|ETH|DOGE)\b/i);
    if(cryptoMatch){
        const symbol=cryptoMatch[1].toUpperCase();
        const price = await getCryptoPrice(symbol);
        if(price !== null){
            addMessage(`Captain Nol: The current ${symbol} price is $${price}`, "bot");
            return;
        } else {
            addMessage("Captain Nol: I cannot fetch that crypto price at the moment.", "bot");
            return;
        }
    }

    // Normal AI response
    try{
        const body = {
            model: MODEL,
            messages: [
                {role:"system", content:SYSTEM_PROMPT},
                {role:"user", content:text}
            ]
        };
        const res = await fetch(API_URL, {
            method:"POST",
            headers:{
                "Authorization":"Bearer "+API_KEY,
                "Content-Type":"application/json"
            },
            body: JSON.stringify(body)
        });
        if(!res.ok){
            const txt = await res.text();
            addMessage("Error: "+txt,"bot");
            return;
        }
        const data = await res.json();
        const ans = data.choices?.[0]?.message?.content || "No response";
        addMessage(ans,"bot");
    }catch(e){
        addMessage("Error: "+e.message,"bot");
    }
}

sendBtn.onclick = ()=>sendMessage(inputEl.value);
inputEl.addEventListener("keydown",e=>{if(e.key==="Enter") sendMessage(inputEl.value);});
</script>

</body>
</html>
