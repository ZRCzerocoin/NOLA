<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NOL space â€” Crypto & X Trends</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="config.js"></script>
<style>
  body, html {
    margin:0; padding:0;
    font-family: Arial, sans-serif;
    background: #1a0e2a;
    color: #f0f0f0;
  }

  header {
    background: linear-gradient(90deg,#4b1979,#1e3e9c);
    color: white;
    padding:1rem;
    text-align:center;
    position: relative;
  }
  header h1 {
    display: inline-block;
    vertical-align: middle;
  }
  header img.logo {
    width:24px; height:24px;
    border-radius:50%;
    margin-right:0.5rem;
    vertical-align: middle;
  }

  #layout { display:flex; height: calc(100vh - 100px); }

  #sidebar {
    width:200px;
    background: rgba(75,25,121,0.85);
    color:white;
    padding:1rem;
    box-sizing:border-box;
    backdrop-filter: blur(8px);
    border-right: 1px solid rgba(255,255,255,0.1);
  }
  #sidebar h2 { font-size:1.2rem; margin-top:0; }
  #sidebar ul { padding:0; list-style:none; }
  #sidebar li { margin:0.5rem 0; cursor:pointer; }
  #sidebar li:hover { text-decoration: underline; }

  #main {
    flex:1;
    overflow-y:auto;
    padding:1rem;
    box-sizing:border-box;
    background: linear-gradient(180deg,#1a0e2a,#0f0515);
  }

  .section { margin-bottom:2rem; }
  .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(360px,1fr)); gap:1rem; }

  .tweet-card {
    position: relative;
    background: rgba(255,255,255,0.05);
    border-radius:12px;
    backdrop-filter: blur(10px);
    padding:0.5rem;
    display:flex; flex-direction:column;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .tweet-card:hover {
    transform: translateY(-3px);
    box-shadow:0 8px 25px rgba(0,0,0,0.5);
  }
  .tweet-card iframe {
    border-radius:12px;
    width:100%;
    min-height:200px;
    max-height:450px;
    border:none;
    overflow:hidden;
    opacity:0;
    animation:fadeIn 0.7s forwards;
  }

  @keyframes fadeIn {
    to { opacity:1; }
  }

  .analytics {
    margin-top:0.5rem;
    padding:0.5rem;
    background: rgba(255,255,255,0.1);
    border-radius:8px;
    font-size:0.8rem;
  }
  .analytics .label { font-weight:bold; margin-right:0.5rem; }
  .positive { color:#4caf50; }
  .negative { color:#f44336; }
  .neutral { color:#9e9e9e; }

  footer {
    background: linear-gradient(90deg,#4b1979,#1e3e9c);
    color:white;
    padding:1rem;
    text-align:center;
  }
  footer a { color:#f39c12; text-decoration:none; margin:0 0.5rem; }
</style>
</head>
<body>

<header>
  <img src="/Link/logo.gif" class="logo" alt="logo"/>
  <h1>NOL space</h1>
</header>

<div id="layout">
  <div id="sidebar">
    <h2>Sections</h2>
    <ul>
      <li data-sec="xtrends">X Trends</li>
      <li data-sec="news">News</li>
      <li data-sec="ethereum">Ethereum</li>
      <li data-sec="polygon">Polygon</li>
      <li data-sec="solana">Solana</li>
      <li data-sec="bnb">BNB</li>
    </ul>
  </div>

  <div id="main">
    <p>Loading dashboard...</p>
  </div>
</div>

<footer>
  NOLA Â© All Rights Reserved.
  <a href="https://nol.pages.dev" target="_blank">Website</a> |
  <a href="https://x.com/NOLA_CHAIN" target="_blank">X</a> |
  <a href="mailto:support@nola.work.gd">Support</a>
</footer>

<script>
// ========= CONFIG ==========
const CACHE_KEY = "NOL_TWEETS_CACHE";
const CACHE_HOURS = 72; // 3 days
const X_ACCOUNT = "PEN2VA"; // for backend fetch, not shown
const MAX_PER_SECTION = 10;

// Chains
const CHAINS = {
  ethereum: ["ETH","ETHEREUM"],
  polygon: ["MATIC","POL","POLYGON"],
  solana: ["SOL","SOLANA"],
  bnb: ["BNB","BINANCE"]
};

// ========= SENTIMENT ==========
function estimateSentiment(txt) {
  txt = txt.toLowerCase();
  if(/pump|moon|up|gain|rocket|bull/i.test(txt)) return {label:"Bullish", class:"positive", icon:"ðŸš€"};
  if(/dump|down|crash|bear|loss/i.test(txt)) return {label:"Bearish", class:"negative", icon:"ðŸ“‰"};
  if(/trump|elon|musk|fed|federal reserve|bank/i.test(txt)) return {label:"Important", class:"neutral", icon:"â­"};
  return {label:"Neutral", class:"neutral", icon:"â€¢"};
}

// ========= CACHE ==========
function getCache() {
  let data = localStorage.getItem(CACHE_KEY);
  if(!data) return null;
  data = JSON.parse(data);
  const ageH = (Date.now() - data.time)/(1000*60*60);
  if(ageH > CACHE_HOURS) return null;
  return data.data;
}
function setCache(data) {
  localStorage.setItem(CACHE_KEY, JSON.stringify({time:Date.now(),data}));
}

// ========= FETCH TWEETS ==========
async function fetchTweets() {
  const cached = getCache();
  if(cached) return cached;

  const bearer = window.BARRIER_KEY;
  if(!bearer) return [];

  try {
    const res = await fetch(`https://api.x.com/2/users/by/username/${X_ACCOUNT}`,{
      headers: { "Authorization": `Bearer ${bearer}` }
    });
    const userData = await res.json();
    const userId = userData.data.id;

    const tweetsRes = await fetch(`https://api.x.com/2/users/${userId}/tweets?max_results=50`,{
      headers: { "Authorization": `Bearer ${bearer}` }
    });
    const json = await tweetsRes.json();
    const tweets = json.data || [];
    setCache(tweets);
    return tweets;
  } catch(e) {
    console.error("Error fetching X tweets:",e);
    return [];
  }
}

// ========= RENDER TWEETS ==========
function createTweetCard(tweet) {
  const s = estimateSentiment(tweet.text);
  return `
  <div class="tweet-card">
    <iframe srcdoc='<blockquote class="twitter-tweet"><p>${tweet.text}</p></blockquote><script async src="https://platform.twitter.com/widgets.js"></script>'></iframe>
    <div class="analytics">
      <span class="label ${s.class}">${s.icon} ${s.label}</span>
    </div>
  </div>`;
}

function renderSection(tweets, section) {
  let symbols = CHAINS[section] || [];
  let filtered = tweets.filter(t =>
    symbols.some(s => t.text.toUpperCase().includes(s))
  );
  // Tweets not matching chain go to X Trends
  if(section === "xtrends") filtered = tweets;

  filtered = filtered.slice(0, MAX_PER_SECTION);

  const htmlCards = filtered.map(createTweetCard).join("");
  return `<div class="section"><h2>${section.toUpperCase()}</h2><div class="grid">${htmlCards}</div></div>`;
}

// ========= LOAD ==========
async function loadSection(section) {
  const main = document.getElementById("main");
  main.innerHTML = "<p>Loading...</p>";
  const tweets = await fetchTweets();

  if(section === "news") {
    main.innerHTML = `<div class="section"><h2>ðŸ“° News</h2><p>Soon</p></div>`;
  } else if(CHAINS[section] || section === "xtrends") {
    main.innerHTML = renderSection(tweets, section);
  } else {
    main.innerHTML = "<p>Unknown section</p>";
  }
}

// Sidebar click
document.querySelectorAll("#sidebar li").forEach(li=>{
  li.addEventListener("click",()=>loadSection(li.getAttribute("data-sec")));
});

// Default load
loadSection("xtrends");

// ========= LIVE UPDATE EVERY 15 MINUTES ==========
setInterval(()=>loadSection("xtrends"),15*60*1000);

</script>
</body>
</html>
