<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NOL space â€” Smart Crypto & X Trends</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="config.js"></script>
<style>
  body, html { margin:0; padding:0; font-family: Arial, sans-serif; background:#f5f6fa; color:#222; }
  header { background:#2c3e50; color:white; padding:1rem; text-align:center; display:flex; align-items:center; justify-content:center; gap:0.5rem; }
  header img { width:24px; height:24px; border-radius:50%; }
  #layout { display:flex; height:calc(100vh - 100px); }
  #sidebar { width:200px; background:#34495e; color:white; padding:1rem; box-sizing:border-box; }
  #sidebar h2 { font-size:1.2rem; margin:0 0 1rem 0; }
  #sidebar ul { padding:0; margin:0; list-style:none; }
  #sidebar li { padding:0.5rem 0; cursor:pointer; }
  #sidebar li:hover { text-decoration:underline; }
  #main { flex:1; overflow-y:auto; padding:1rem; }
  .section { margin-bottom:2rem; }
  .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(240px,1fr)); gap:1rem; }
  .card { background:white; border-radius:8px; box-shadow:0 1px 4px rgba(0,0,0,0.1); padding:1rem; display:flex; flex-direction:column; }
  .meta { font-size:0.8rem; color:#555; margin:0.3rem 0; }
  .positive { color:green; }
  .negative { color:red; }
  .neutral { color:gray; }
  footer { background:#2c3e50; color:white; padding:1rem; text-align:center; }
  footer a { color:#f39c12; text-decoration:none; margin:0 0.5rem; }
</style>
</head>
<body>

<header>
  <img src="/Link/logo.gif" alt="NOL logo">
  <h1>NOL space</h1>
</header>

<div id="layout">
  <div id="sidebar">
    <h2>Sections</h2>
    <ul>
      <li data-sec="xtrends">X Trends</li>
      <li data-sec="news">News</li>
      <li data-sec="ethereum">Ethereum</li>
      <li data-sec="polygon">Polygon</li>
      <li data-sec="solana">Solana</li>
      <li data-sec="bnb">BNB</li>
    </ul>
  </div>
  <div id="main"><p>Loading dashboard...</p></div>
</div>

<footer>
  NOLA Â© All Rights Reserved.  
  <a href="https://nol.pages.dev" target="_blank">Website</a> | 
  <a href="https://x.com/NOLA_CHAIN" target="_blank">X</a> | 
  <a href="mailto:support@nola.work.gd">Support</a>
</footer>

<script>
// ================= CONFIG =================
const MAX_TWEETS_PER_SECTION = 10;
const X_ACCOUNT = "@PEN2VA";
const SECTION_KEYS = ["xtrends","ethereum","polygon","solana","bnb"];
const CHAINS = {
  ethereum:["ETH","ETHEREUM"],
  polygon:["POL","MATIC","POLYGON"],
  solana:["SOL","SOLANA"],
  bnb:["BNB","BINANCE COIN"]
};
const SMART_KEYWORDS = [
  "crypto","bitcoin","btc","ethereum","eth","polygon","matic","solana","sol","bnb","binance","web3",
  "trading","stocks","investment","investments","finance","market","defi","DeFi","NFT","nft","NFTs",
  "elon","musk","trump","fed","federal reserve","sec","government","bank","central bank","stock market",
  "bullish","bearish","pump","moon","dump","crash","rally","gain","loss","up","down","rocket"
];

// ================= SENTIMENT =================
function estimateSentiment(txt){
  txt = txt.toLowerCase();
  if(/pump|moon|up|gain|rocket/.test(txt)) return {label:"Bullish", class:"positive", icon:"ðŸš€"};
  if(/dump|down|crash|bear|loss/.test(txt)) return {label:"Bearish", class:"negative", icon:"ðŸ“‰"};
  return {label:"Neutral", class:"neutral", icon:"â€¢"};
}

// ================= CACHE =================
function getSectionCache(section){
  const cache = JSON.parse(localStorage.getItem(`CACHE_${section}`)||"{}");
  return cache.tweets || [];
}

function saveSectionCache(section, tweets){
  localStorage.setItem(`CACHE_${section}`, JSON.stringify({tweets}));
}

// ================= FETCH X =================
async function fetchTweetsFromX(max_results=10){
  const bearer = window.BARRIER_KEY;
  if(!bearer){ console.error("BARRIER_KEY missing"); return []; }
  try{
    // Fetch user ID first
    let res = await fetch(`https://api.x.com/2/users/by/username/${X_ACCOUNT.replace('@','')}?user.fields=id`, {
      headers: {"Authorization":`Bearer ${bearer}`}
    });
    const userData = await res.json();
    const userId = userData.data?.id;
    if(!userId) return [];

    // Fetch tweets
    res = await fetch(`https://api.x.com/2/users/${userId}/tweets?max_results=${max_results}&tweet.fields=created_at,text`, {
      headers: {"Authorization":`Bearer ${bearer}`}
    });
    const json = await res.json();
    return json.data || [];
  } catch(e){ console.error("X fetch error", e); return []; }
}

// ================= CATEGORIZE =================
function categorizeTweet(tweet){
  const txt = tweet.text.toUpperCase();
  for(const chain in CHAINS){
    if(CHAINS[chain].some(k=>txt.includes(k))) return chain;
  }
  // Check keywords for X Trends
  for(const kw of SMART_KEYWORDS){
    if(txt.includes(kw.toUpperCase())) return "xtrends";
  }
  return "xtrends";
}

// ================= MERGE =================
function mergeTweet(section, tweet){
  const tweets = getSectionCache(section);
  // Avoid duplicates
  if(tweets.some(t=>t.id===tweet.id)) return;
  if(tweets.length >= MAX_TWEETS_PER_SECTION){
    tweets.shift(); // remove oldest
  }
  tweets.push(tweet);
  saveSectionCache(section, tweets);
}

// ================= RENDER =================
function renderSection(section){
  const tweets = getSectionCache(section);
  if(!tweets.length) return `<div class="section"><h2>${section.toUpperCase()}</h2><p>No tweets yet</p></div>`;
  return `<div class="section"><h2>${section.toUpperCase()}</h2>
    <div class="grid">
      ${tweets.map(t=>{
        const s = estimateSentiment(t.text);
        return `<div class="card">
          <h3>${s.icon} ${t.text}</h3>
          <div class="meta ${s.class}">Sentiment: ${s.label}</div>
        </div>`;
      }).join("")}
    </div>
  </div>`;
}

// ================= LOAD SECTION =================
async function loadSection(section){
  const main = document.getElementById("main");
  main.innerHTML="<p>Loading...</p>";

  const tweets = await fetchTweetsFromX(5); // fetch latest 5 tweets per refresh
  tweets.forEach(tweet=>{
    const cat = categorizeTweet(tweet);
    mergeTweet(cat, tweet);
  });

  main.innerHTML = renderSection(section);
}

// ================= SIDEBAR =================
document.querySelectorAll("#sidebar li").forEach(li=>{
  li.addEventListener("click", ()=>loadSection(li.getAttribute("data-sec")));
});

// ================= INITIAL =================
SECTION_KEYS.forEach(sec=>{
  if(!localStorage.getItem(`CACHE_${sec}`)) saveSectionCache(sec, []);
});

loadSection("xtrends");

// ================= PERIODIC FETCH =================
setInterval(async ()=>{
  const tweets = await fetchTweetsFromX(3); // 3 new tweets per 24h
  tweets.forEach(tweet=>{
    const cat = categorizeTweet(tweet);
    mergeTweet(cat, tweet);
  });
}, 24*60*60*1000);

</script>
</body>
</html>
