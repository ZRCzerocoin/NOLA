<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NOL space â€” Crypto & X Trends</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="config.js"></script>
<link rel="icon" href="/Link/logo.gif">
<style>
body, html {margin:0;padding:0;font-family:Arial,sans-serif;background:#f5f6fa;color:#222;}
header {background:#2c3e50;color:white;padding:1rem;text-align:center;display:flex;align-items:center;justify-content:center;}
header img {width:24px;height:24px;margin-right:0.5rem;border-radius:50%;}
#layout {display:flex;height:calc(100vh - 100px);}
#sidebar {width:200px;background:#34495e;color:white;padding:1rem;box-sizing:border-box;}
#sidebar h2 {font-size:1.2rem;margin:0 0 1rem 0;}
#sidebar ul {padding:0;margin:0;list-style:none;}
#sidebar li {padding:0.5rem 0;cursor:pointer;}
#sidebar li:hover {text-decoration:underline;}
#main {flex:1;overflow-y:auto;padding:1rem;}
.section {margin-bottom:2rem;}
.grid {display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:1rem;}
.card {background:white;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,0.1);padding:1rem;display:flex;flex-direction:column;}
.meta {font-size:0.8rem;color:#555;margin:0.3rem 0;}
.positive{color:green;}.negative{color:red;}.neutral{color:gray;}
footer {background:#2c3e50;color:white;padding:1rem;text-align:center;}
footer a {color:#f39c12;text-decoration:none;margin:0 0.5rem;}
</style>
</head>
<body>
<header><img src="/Link/logo.gif" alt="NOL Logo"/><h1>NOL space</h1></header>

<div id="layout">
<div id="sidebar">
<h2>Sections</h2>
<ul>
<li data-sec="xtrends">X Trends</li>
<li data-sec="news">News</li>
<li data-sec="ethereum">Ethereum</li>
<li data-sec="polygon">Polygon</li>
<li data-sec="solana">Solana</li>
<li data-sec="bnb">BNB</li>
</ul>
</div>

<div id="main"><p>Loading dashboard...</p></div>
</div>

<footer>
NOLA Â© All Rights Reserved. 
<a href="https://nol.pages.dev" target="_blank">Website</a> |
<a href="https://x.com/NOLA_CHAIN" target="_blank">X</a> |
<a href="mailto:support@nola.work.gd">Support</a>
</footer>

<script>
// ===== CONFIG =====
const CACHE_KEY = "NOL_CACHE";
const CACHE_DAYS = 3;
const SECTION_KEYS = ["xtrends","ethereum","polygon","solana","bnb"];
const X_ACCOUNT = "@PEN2VA"; // monitored account
const MAX_TWEETS_PER_SECTION = 10;

// Multi-chain symbols
const CHAINS = {
  ethereum:["ETH","ETHEREUM"],
  polygon:["MATIC","POL","POLYGON"],
  solana:["SOL","SOLANA"],
  bnb:["BNB","BINANCE"]
};

// Coingecko IDs for live prices
const COINS = {
  ethereum:"ethereum",
  polygon:"polygon",
  solana:"solana",
  bnb:"binancecoin"
};

// Keywords for smart categorization
const KEYWORDS = [
"crypto","bitcoin","btc","ethereum","eth","polygon","matic","solana","bnb","binance",
"defi","web3","trading","stocks","investment","investing","nft","nftproject","tokens","coins",
"elon musk","trump","federal reserve","fed","bank","official","market","rally","pump","moon",
"dump","bear","crash","up","gain","loss","rocket","bull","bear","financial","coinbase","kraken",
"staking","yield","liquidity","fund","venture","governance","dao","metaverse","layer1","layer2",
"smart contract","dapp","tokenomics","airdrop","mint","hodl","decentralized","centralized",
"treasury","satoshi","hodler","rekt","liquidation","margin","fomo","fud","whale","shill","altcoin",
"altcoins","token","eth2","bitcoin cash","dogecoin","ripple","cardano","sol","maticnetwork",
"crypto regulation","securities","sec","ceo","cfo","cex","dex","staking rewards","apy","apr",
"price prediction","crypto news","financial news","trading signals","market cap","volume",
"derivatives","futures","options","stablecoin","usdt","usdc","coin listing","token launch","ico",
"ieo","crypto adoption","nft marketplace","degen","gaming","play to earn","p2e","layer2 scaling",
"cross chain","bridge","validator","node","blockchain protocol","gas fee","tx fee","oracle",
"price feed","market data","on chain","off chain","cex listing","burn","tokenomics event","airdrops",
"portfolio","rebalancing","financial literacy","institutional investor","crypto ETF","bitcoin ETF"
];

// Sentiment analysis
function estimateSentiment(txt){
  txt = txt.toLowerCase();
  if(/pump|moon|up|gain|rocket/.test(txt)) return {label:"Bullish",class:"positive",icon:"ðŸš€"};
  if(/dump|down|crash|bear|loss/.test(txt)) return {label:"Bearish",class:"negative",icon:"ðŸ“‰"};
  return {label:"Neutral",class:"neutral",icon:"â€¢"};
}

// ===== CACHE =====
function getCache(){
  let d = localStorage.getItem(CACHE_KEY);
  if(!d) return {};
  try { d = JSON.parse(d); } catch(e){ return {}; }
  // remove old caches
  const now = Date.now();
  Object.keys(d).forEach(k=>{
    if((now - d[k].time)/(1000*60*60*24) > CACHE_DAYS) delete d[k];
  });
  return d;
}

function saveCache(cache){
  localStorage.setItem(CACHE_KEY,JSON.stringify(cache));
}

function getSectionCache(section){
  const cache = getCache();
  return cache[section]?.tweets || [];
}

function saveSectionCache(section,tweets){
  const cache = getCache();
  cache[section] = {tweets,time:Date.now()};
  saveCache(cache);
}

// ===== FETCH X TWEETS =====
async function fetchXAccountTweets(){
  try{
    const bearer = window.BARRIER_KEY;
    if(!bearer){ console.error("BARRIER_KEY missing"); return []; }
    const url = `https://api.x.com/2/tweets?ids=${X_ACCOUNT}&tweet.fields=created_at,author_id`;
    const res = await fetch(url,{headers:{"Authorization":`Bearer ${bearer}`}});
    const data = await res.json();
    return data.data || [];
  } catch(e){ console.error(e); return []; }
}

// ===== FETCH COIN PRICE =====
async function fetchCoinPrice(coin){
  if(!COINGECKO) return null;
  try{
    const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coin}&vs_currencies=usd`);
    const data = await res.json();
    return data[coin]?.usd || null;
  } catch(e){ console.error("Coingecko error",e); return null; }
}

// ===== CATEGORIZE TWEETS =====
function categorizeTweet(tweet){
  const txt = tweet.text.toLowerCase();
  for(const chain in CHAINS){
    if(CHAINS[chain].some(sym=>txt.includes(sym.toLowerCase()))) return chain;
  }
  // check keywords for xtrends
  for(const kw of KEYWORDS){
    if(txt.includes(kw.toLowerCase())) return "xtrends";
  }
  return "xtrends";
}

// ===== MERGE NEW TWEETS =====
function mergeTweet(section,tweet){
  const tweets = getSectionCache(section);
  if(tweets.some(t=>t.id===tweet.id)) return;
  tweets.unshift(tweet);
  if(tweets.length>MAX_TWEETS_PER_SECTION) tweets.pop();
  saveSectionCache(section,tweets);
}

// ===== ADD PRICES TO TWEETS =====
async function addPricesToTweets(section){
  const tweets = getSectionCache(section);
  for(const tweet of tweets){
    for(const chain in CHAINS){
      if(CHAINS[chain].some(sym=>tweet.text.toUpperCase().includes(sym))){
        tweet.price = await fetchCoinPrice(COINS[chain]);
      }
    }
  }
  saveSectionCache(section,tweets);
}

// ===== RENDER =====
function renderSection(section){
  const tweets = getSectionCache(section);
  if(!tweets.length) return `<div class="section"><h2>${section.toUpperCase()}</h2><p>No tweets.</p></div>`;
  return `<div class="section"><h2>${section.toUpperCase()}</h2><div class="grid">
  ${tweets.map(t=>{
    const s = estimateSentiment(t.text);
    const priceHtml = t.price ? `<div class="meta">Price: $${t.price}</div>` : "";
    return `<div class="card"><h3>${s.icon} ${t.text}</h3>${priceHtml}<div class="meta ${s.class}">Sentiment: ${s.label}</div></div>`;
  }).join("")}
  </div></div>`;
}

function renderNews(){ return `<div class="section"><h2>ðŸ“° News</h2><p>Soon</p></div>`; }

// ===== LOAD SECTION =====
async function loadSection(section){
  const main = document.getElementById("main");
  main.innerHTML="<p>Loading...</p>";

  const liveTweets = await fetchXAccountTweets();
  liveTweets.forEach(tweet=>{
    const sec = categorizeTweet(tweet);
    mergeTweet(sec,tweet);
  });

  if(section==="news") main.innerHTML = renderNews();
  else main.innerHTML = renderSection(section);
}

// ===== AUTO REFRESH =====
setInterval(async()=>{
  for(const sec of SECTION_KEYS){
    const liveTweets = await fetchXAccountTweets();
    liveTweets.forEach(tweet=>{
      const secCat = categorizeTweet(tweet);
      mergeTweet(secCat,tweet);
    });
    await addPricesToTweets(sec);
  }
  if(currentSection) loadSection(currentSection);
},24*60*60*1000); // 24h

let currentSection = "xtrends";
document.querySelectorAll("#sidebar li").forEach(li=>{
  li.addEventListener("click",()=>{ currentSection=li.getAttribute("data-sec"); loadSection(currentSection); });
});

// Initial load
loadSection(currentSection);
</script>
</body>
</html>
