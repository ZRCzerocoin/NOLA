<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NOL space ‚Äî Crypto & Finance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body, html { margin:0; padding:0; font-family: Arial, sans-serif; background: #f5f6fa; color: #222; }
  header { background: rgba(44, 62, 80, 0.85); color: white; padding: 1rem; text-align: center; backdrop-filter: blur(8px); }
  #layout { display: flex; height: calc(100vh - 60px); }
  #sidebar {
    width: 200px;
    background: rgba(52, 73, 94, 0.85);
    color: white;
    padding: 1rem;
    box-sizing: border-box;
    backdrop-filter: blur(8px);
    border-right: 1px solid rgba(255,255,255,0.1);
  }
  #sidebar h2 { font-size: 1.2rem; margin-top: 0; }
  #sidebar ul { list-style: none; padding: 0; }
  #sidebar li { margin: 0.5rem 0; cursor: pointer; }
  #sidebar li:hover { text-decoration: underline; }
  #main { flex: 1; overflow-y: auto; padding: 1rem; box-sizing: border-box; }
  .section { margin-bottom: 2rem; }
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap: 1rem; }
  .card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    padding: 1rem;
    display: flex;
    flex-direction: column;
    position: relative;
  }
  .card h3 { margin: 0 0 0.5rem 0; font-size:1rem; }
  .meta { font-size: 0.75rem; color: #555; margin-bottom: 0.5rem; }
  .positive { color: green; }
  .negative { color: red; }
  .neutral { color: gray; }
  a { text-decoration: none; color: #2980b9; margin-top: auto; font-weight: bold; font-size:0.8rem; }
  canvas { width: 100%; height: 40px; }
  footer { background: rgba(44, 62, 80, 0.85); color: white; padding: 1rem; text-align: center; font-size:0.8rem; backdrop-filter: blur(8px); margin-top:auto;}
  footer a { color: #f39c12; margin: 0 0.5rem; text-decoration: none;}
</style>
</head>
<body>
<header><h1>NOL space</h1></header>
<div id="layout">
  <div id="sidebar">
    <h2>Sections</h2>
    <ul>
      <li data-section="news">News</li>
      <li data-section="xtrends">X Trends</li>
      <li data-section="polygon">Polygon</li>
      <li data-section="ethereum">Ethereum</li>
      <li data-section="solana">Solana</li>
    </ul>
  </div>
  <div id="main">
    <p>Loading dashboard...</p>
  </div>
</div>

<footer>
  ¬© 2025 NOLA. All rights reserved.  
  <a href="https://nol.pages.dev" target="_blank">Website</a> | 
  <a href="https://x.com/NOLA_CHAIN" target="_blank">X</a> | 
  <a href="mailto:support@nola.work.gd">Support</a>
</footer>

<script>
const COINGECKO_API = 'https://api.coingecko.com/api/v3';
const CHAINS = {
  ethereum: { name:'Ethereum', symbols:['ETH'] },
  polygon: { name:'Polygon', symbols:['POL','MATIC'] },
  solana: { name:'Solana', symbols:['SOL'] }
};

const KEYWORDS = [
  "nft","NftNFT","crypto","Defi","defi","web3",
  "crypto_project","investment","investing",
  "stocks","finance","Bitcoin","BTC","btc",
  "pos","pol","POS","Polygon","Matic",
  "solana","blockchain","trading","coins","tokens"
];

let currentSection='news';

// ------------------ CoinGecko ------------------
async function fetchCoins(){
  try{
    const res = await fetch(`${COINGECKO_API}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&page=1&sparkline=false`);
    return await res.json();
  }catch(e){ console.error(e); return []; }
}

async function fetchSparkline(id){
  try{
    const res = await fetch(`${COINGECKO_API}/coins/${id}/market_chart?vs_currency=usd&days=1&interval=hourly`);
    const data = await res.json();
    return data.prices.map(p=>p[1]);
  }catch(e){ return []; }
}

function drawSparkline(canvas, prices){
  if(!prices.length) return;
  const ctx=canvas.getContext('2d');
  const w=canvas.width; const h=canvas.height;
  const max=Math.max(...prices); const min=Math.min(...prices);
  ctx.clearRect(0,0,w,h);
  ctx.beginPath();
  prices.forEach((p,i)=>{
    const x=i*(w/(prices.length-1));
    const y=h-(p-min)/(max-min)*h;
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.strokeStyle='#2980b9';
  ctx.lineWidth=2;
  ctx.stroke();
}

function sortByChange(coins){
  const top = coins.filter(c=>c.price_change_percentage_24h>0).sort((a,b)=>b.price_change_percentage_24h-a.price_change_percentage_24h);
  const bottom = coins.filter(c=>c.price_change_percentage_24h<0).sort((a,b)=>a.price_change_percentage_24h-b.price_change_percentage_24h);
  return {top,bottom};
}

function cardHtml(c){
  const change=c.price_change_percentage_24h||0;
  return `
  <div class="card">
    <h3>${c.name} (${c.symbol.toUpperCase()})</h3>
    <div class="meta">Price: $${c.current_price.toLocaleString()}</div>
    <div class="meta">24h Change: <span class="${change>=0?'positive':'negative'}">${change.toFixed(2)}%</span></div>
    <div class="meta">Market Cap: $${c.market_cap.toLocaleString()}</div>
    <canvas id="spark-${c.id}"></canvas>
    <a href="https://www.coingecko.com/en/coins/${c.id}" target="_blank">Details</a>
  </div>`;
}

async function renderChainSection(chainKey, coins){
  const chain=CHAINS[chainKey];
  const filtered=coins.filter(c=>chain.symbols.includes(c.symbol.toUpperCase()));
  const {top,bottom}=sortByChange(filtered);
  const html=`
    <div class="section"><h2>Top Gainers ‚Äî ${chain.name}</h2><div class="grid">${top.map(cardHtml).join('')}</div></div>
    <div class="section"><h2>Top Losers ‚Äî ${chain.name}</h2><div class="grid">${bottom.map(cardHtml).join('')}</div></div>`;
  document.getElementById('main').innerHTML=html;

  for(const c of filtered){
    const canvas=document.getElementById(`spark-${c.id}`);
    if(canvas){
      const prices=await fetchSparkline(c.id);
      drawSparkline(canvas, prices);
    }
  }
}

// ------------------ Sentiment ------------------
function estimateSentiment(text){
  const lower=text.toLowerCase();
  if(/bull|moon|pump|rally|gain|up/i.test(lower)) return {label:'Bullish',class:'positive',icon:'‚ñ≤'};
  if(/bear|dump|crash|down|loss/i.test(lower)) return {label:'Bearish',class:'negative',icon:'‚ñº'};
  return {label:'Neutral',class:'neutral',icon:'‚óè'};
}

// ------------------ Tweets / X Trends ------------------
const CHAINS_FILTERS = {
  polygon: ["pol","POL","matic","MATIC","Polygon"],
  ethereum: ["eth","ETH","ethereum","ETHEREUM"],
  solana: ["sol","SOL","solana","SOLANA"]
};

// Simulated tweet fetch (replace with real X API)
async function fetchTweets(keywords=[], max=50){
  try{
    // Simulated tweets
    let tweets=[];
    for(let i=1;i<=max;i++){
      const text = `${keywords[i%keywords.length]} trending crypto tweet #${i}`;
      tweets.push({
        text, user:{screen_name:`user${i}`}, retweet_count:i*2, favorite_count:i*5, id_str:`${1000+i}`
      });
    }
    return tweets;
  }catch(e){ console.error(e); return []; }
}

function filterTweetsByChain(tweets, chainKey){
  const filters = CHAINS_FILTERS[chainKey];
  return tweets.filter(t => filters.some(f => t.text.toLowerCase().includes(f.toLowerCase())));
}

function renderTweets(tweets, title){
  return `
    <div class="section"><h2>${title}</h2>
      <div class="grid">
        ${tweets.map(t => {
          const sentiment = estimateSentiment(t.text);
          return `<div class="card">
            <h3>${sentiment.icon} @${t.user.screen_name}</h3>
            <div class="meta ${sentiment.class}">Sentiment: ${sentiment.label}</div>
            <p>${t.text}</p>
            <div class="meta">Retweets: ${t.retweet_count} ‚Äî Likes: ${t.favorite_count}</div>
            <a href="https://twitter.com/${t.user.screen_name}/status/${t.id_str}" target="_blank">View Tweet</a>
          </div>`;
        }).join('')}
      </div>
    </div>`;
}

async function loadXSection(){
  const tweets = await fetchTweets(KEYWORDS, 100);
  const main = document.getElementById('main');
  main.innerHTML = '';
  main.innerHTML += renderTweets(tweets.slice(0,20), "üî∫ X Global Crypto/Finance Trends");

  for(const chainKey of Object.keys(CHAINS_FILTERS)){
    const filtered = filterTweetsByChain(tweets, chainKey);
    main.innerHTML += renderTweets(filtered.slice(0,20), `#${CHAINS[chainKey].name} Tweets`);
  }
}

// ------------------ News placeholder ------------------
async function fetchNews(){ return []; }
function renderNews(articles){
  if(!articles.length) return '<div class="section"><h2>üì∞ News</h2><p>No news feed configured (yet).</p></div>';
  return `<div class="section"><h2>üì∞ Crypto / Finance News</h2>
    <div class="grid">${articles.map(a=>`<div class="card">
      <h3>${a.title}</h3>
      <div class="meta">Source: ${a.source} ‚Äî ${new Date(a.publishedAt).toLocaleString()}</div>
      <p>${a.description||''}</p>
      <a href="${a.url}" target="_blank">Read more</a></div>`).join('')}</div></div>`;
}

// ------------------ Load section ------------------
async function loadSection(section){
  currentSection=section;
  const main=document.getElementById('main');
  main.innerHTML='<p>Loading...</p>';
  const coins=await fetchCoins();
  if(section==='news'){ const articles=await fetchNews(); main.innerHTML=renderNews(articles); }
  else if(section==='xtrends'){ await loadXSection(); }
  else if(CHAINS[section]) await renderChainSection(section, coins);
}

// ------------------ Sidebar ------------------
document.querySelectorAll('#sidebar li').forEach(li=>li.addEventListener('click',e=>loadSection(e.target.getAttribute('data-section'))));

// Default load
window.addEventListener('load',()=>loadSection('news'));

// Auto-refresh 60s
setInterval(()=>{loadSection(currentSection);},60000);
</script>
</body>
</html>
