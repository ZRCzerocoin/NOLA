<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NOL space â€” Crypto & Finance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body, html { margin:0; padding:0; font-family: Arial, sans-serif; background: #f5f6fa; color: #222; }
  header { background: rgba(44, 62, 80, 0.85); color: white; padding: 1rem; text-align: center; backdrop-filter: blur(8px); }
  #layout { display: flex; height: calc(100vh - 60px); }
  #sidebar {
    width: 200px;
    background: rgba(52, 73, 94, 0.85);
    color: white;
    padding: 1rem;
    box-sizing: border-box;
    backdrop-filter: blur(8px);
    border-right: 1px solid rgba(255,255,255,0.1);
  }
  #sidebar h2 { font-size: 1.2rem; margin-top: 0; }
  #sidebar ul { list-style: none; padding: 0; }
  #sidebar li { margin: 0.5rem 0; cursor: pointer; }
  #sidebar li:hover { text-decoration: underline; }
  #main { flex: 1; overflow-y: auto; padding: 1rem; box-sizing: border-box; }
  .section { margin-bottom: 2rem; }
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap: 1rem; }
  .card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    padding: 1rem;
    display: flex;
    flex-direction: column;
    position: relative;
  }
  .card h3 { margin: 0 0 0.5rem 0; font-size:1rem; }
  .meta { font-size: 0.75rem; color: #555; margin-bottom: 0.5rem; }
  .positive { color: green; }
  .negative { color: red; }
  .neutral { color: gray; }
  a { text-decoration: none; color: #2980b9; margin-top: auto; font-weight: bold; font-size:0.8rem; }
  canvas { width: 100%; height: 40px; }
</style>
</head>
<body>
<header><h1>NOL space</h1></header>
<div id="layout">
  <div id="sidebar">
    <h2>Sections</h2>
    <ul>
      <li data-section="news">News</li>
      <li data-section="xtrends">X Trends</li>
      <li data-section="polygon">Polygon</li>
      <li data-section="ethereum">Ethereum</li>
      <li data-section="solana">Solana</li>
    </ul>
  </div>
  <div id="main">
    <p>Loading dashboard...</p>
  </div>
</div>

<script>
const COINGECKO_API = 'https://api.coingecko.com/api/v3';
const CHAINS = {
  ethereum: { name:'Ethereum', symbols:['ETH'] },
  polygon: { name:'Polygon', symbols:['POL','MATIC'] },
  solana: { name:'Solana', symbols:['SOL'] }
};

let currentSection='news';

// Fetch coins
async function fetchCoins(){
  try{
    const res = await fetch(`${COINGECKO_API}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&page=1&sparkline=false`);
    return await res.json();
  }catch(e){ console.error(e); return []; }
}

// Fetch sparkline for coin
async function fetchSparkline(id){
  try{
    const res = await fetch(`${COINGECKO_API}/coins/${id}/market_chart?vs_currency=usd&days=1&interval=hourly`);
    const data = await res.json();
    return data.prices.map(p=>p[1]);
  }catch(e){ return []; }
}

// Draw sparkline on canvas
function drawSparkline(canvas, prices){
  if(!prices.length) return;
  const ctx=canvas.getContext('2d');
  const w=canvas.width; const h=canvas.height;
  const max=Math.max(...prices); const min=Math.min(...prices);
  ctx.clearRect(0,0,w,h);
  ctx.beginPath();
  prices.forEach((p,i)=>{
    const x=i*(w/(prices.length-1));
    const y=h-(p-min)/(max-min)*h;
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.strokeStyle='#2980b9';
  ctx.lineWidth=2;
  ctx.stroke();
}

// Sort coins by 24h
function sortByChange(coins){
  const top = coins.filter(c=>c.price_change_percentage_24h>0).sort((a,b)=>b.price_change_percentage_24h-a.price_change_percentage_24h);
  const bottom = coins.filter(c=>c.price_change_percentage_24h<0).sort((a,b)=>a.price_change_percentage_24h-b.price_change_percentage_24h);
  return {top,bottom};
}

// Coin card with sparkline placeholder
function cardHtml(c){
  const change=c.price_change_percentage_24h||0;
  return `
  <div class="card">
    <h3>${c.name} (${c.symbol.toUpperCase()})</h3>
    <div class="meta">Price: $${c.current_price.toLocaleString()}</div>
    <div class="meta">24h Change: <span class="${change>=0?'positive':'negative'}">${change.toFixed(2)}%</span></div>
    <div class="meta">Market Cap: $${c.market_cap.toLocaleString()}</div>
    <canvas id="spark-${c.id}"></canvas>
    <a href="https://www.coingecko.com/en/coins/${c.id}" target="_blank">Details</a>
  </div>`;
}

// Render chain
async function renderChainSection(chainKey, coins){
  const chain=CHAINS[chainKey];
  const filtered=coins.filter(c=>chain.symbols.includes(c.symbol.toUpperCase()));
  const {top,bottom}=sortByChange(filtered);
  const html=`
    <div class="section"><h2>Top Gainers â€” ${chain.name}</h2><div class="grid">${top.map(cardHtml).join('')}</div></div>
    <div class="section"><h2>Top Losers â€” ${chain.name}</h2><div class="grid">${bottom.map(cardHtml).join('')}</div></div>`;
  document.getElementById('main').innerHTML=html;

  // Render sparklines
  for(const c of filtered){
    const canvas=document.getElementById(`spark-${c.id}`);
    if(canvas){
      const prices=await fetchSparkline(c.id);
      drawSparkline(canvas, prices);
    }
  }
}

// Sentiment
function estimateSentiment(name){
  const lower=name.toLowerCase();
  if(/bull|moon|pump|rally|gain|up/i.test(lower)) return {label:'Bullish',class:'positive',icon:'â–²'};
  if(/bear|dump|crash|down|loss/i.test(lower)) return {label:'Bearish',class:'negative',icon:'â–¼'};
  return {label:'Neutral',class:'neutral',icon:'â—'};
}

// X Trends
async function fetchXTrends(){
  try{
    const resp=await fetch('https://trendstools.net/json/twitter/global');
    const data=await resp.json();
    return (data.trends||[]).filter(t=>/crypto|bitcoin|ethereum|polygon|solana|stock|finance|trading|investment|market|token|nft/i.test(t.name)).slice(0,20);
  }catch(e){
    console.error(e);
    return [{name:'Bitcoin'},{name:'Ethereum'},{name:'Polygon'},{name:'Solana'},{name:'Crypto Market'},{name:'Stocks'},{name:'Investments'}];
  }
}

function renderXTrends(trends){
  return `
    <div class="section"><h2>ðŸ”º X Trends (crypto / finance)</h2>
      <div class="grid">${trends.map(t=>{
        const s=estimateSentiment(t.name);
        const volume=t.tweet_volume||'N/A';
        return `<div class="card">
          <h3>${s.icon} #${t.name}</h3>
          <div class="meta ${s.class}">Sentiment: ${s.label}</div>
          <div class="meta">Volume: ${volume}</div>
        </div>`}).join('')}</div></div>`;
}

// News placeholder
async function fetchNews(){ return []; }
function renderNews(articles){
  if(!articles.length) return '<div class="section"><h2>ðŸ“° News</h2><p>No news feed configured (yet).</p></div>';
  return `<div class="section"><h2>ðŸ“° Crypto / Finance News</h2>
    <div class="grid">${articles.map(a=>`<div class="card">
      <h3>${a.title}</h3>
      <div class="meta">Source: ${a.source} â€” ${new Date(a.publishedAt).toLocaleString()}</div>
      <p>${a.description||''}</p>
      <a href="${a.url}" target="_blank">Read more</a></div>`).join('')}</div></div>`;
}

// Load section
async function loadSection(section){
  currentSection=section;
  const main=document.getElementById('main');
  main.innerHTML='<p>Loading...</p>';
  const coins=await fetchCoins();
  if(section==='news'){ const articles=await fetchNews(); main.innerHTML=renderNews(articles); }
  else if(section==='xtrends'){ const trends=await fetchXTrends(); main.innerHTML=renderXTrends(trends); }
  else if(CHAINS[section]) await renderChainSection(section, coins);
}

// Sidebar click
document.querySelectorAll('#sidebar li').forEach(li=>li.addEventListener('click',e=>loadSection(e.target.getAttribute('data-section'))));

// Default load
window.addEventListener('load',()=>loadSection('news'));

// Auto-refresh 60s
setInterval(()=>{loadSection(currentSection);},60000);
</script>
</body>
</html>
