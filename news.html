<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NOL space â€” Crypto & Finance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body, html { margin:0; padding:0; font-family: Arial, sans-serif; background: #f5f6fa; color: #222; }
  header { background: rgba(44, 62, 80, 0.85); color: white; padding: 1rem; text-align: center; backdrop-filter: blur(8px); }
  #layout { display: flex; height: calc(100vh - 100px); }
  #sidebar {
    width: 200px;
    background: rgba(52, 73, 94, 0.85);
    color: white;
    padding: 1rem;
    box-sizing: border-box;
    backdrop-filter: blur(8px);
    border-right: 1px solid rgba(255,255,255,0.1);
  }
  #sidebar h2 { font-size: 1.2rem; margin-top: 0; }
  #sidebar ul { list-style: none; padding: 0; }
  #sidebar li { margin: 0.5rem 0; cursor: pointer; }
  #sidebar li:hover { text-decoration: underline; }
  #main { flex: 1; overflow-y: auto; padding: 1rem; box-sizing: border-box; }
  .section { margin-bottom: 2rem; }
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap: 1rem; }
  .card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    padding: 1rem;
    display: flex;
    flex-direction: column;
    position: relative;
  }
  .card h3 { margin: 0 0 0.5rem 0; font-size:1rem; }
  .meta { font-size: 0.75rem; color: #555; margin-bottom: 0.5rem; }
  .positive { color: green; }
  .negative { color: red; }
  .neutral { color: gray; }
  a { text-decoration: none; color: #2980b9; margin-top: auto; font-weight: bold; font-size:0.8rem; }
  canvas { width: 100%; height: 40px; }
  footer {
    background: rgba(44, 62, 80, 0.85);
    color: white;
    padding: 1rem;
    text-align: center;
    backdrop-filter: blur(8px);
  }
  footer a { color: #f39c12; margin: 0 0.5rem; text-decoration: none; }
</style>
</head>
<body>

<header><h1>NOL space</h1></header>

<div id="layout">
  <div id="sidebar">
    <h2>Sections</h2>
    <ul>
      <li data-section="news">News</li>
      <li data-section="xtrends">X Trends</li>
      <li data-section="polygon">Polygon</li>
      <li data-section="ethereum">Ethereum</li>
      <li data-section="solana">Solana</li>
    </ul>
  </div>
  <div id="main"><p>Loading dashboard...</p></div>
</div>

<footer>
  NOLA Â© All Rights Reserved.  
  <a href="https://nol.pages.dev" target="_blank">Website</a> | 
  <a href="https://x.com/NOLA_CHAIN" target="_blank">X</a> | 
  <a href="mailto:support@nola.work.gd">Support</a>
</footer>

<script>
let currentSection='news';

// ======== CONFIG ========
// Replace this URL with your Cloudflare Worker URL
const WORKER_URL = "https://nolspace.workers.dev";

// Chain symbols
const CHAINS = {
  ethereum: { name:'Ethereum', symbols:['ETH'] },
  polygon: { name:'Polygon', symbols:['POL','MATIC'] },
  solana: { name:'Solana', symbols:['SOL'] }
};

// ======== HELPER FUNCTIONS ========

// Draw sparkline
function drawSparkline(canvas, prices){
  if(!prices.length) return;
  const ctx=canvas.getContext('2d');
  const w=canvas.width; const h=canvas.height;
  const max=Math.max(...prices); const min=Math.min(...prices);
  ctx.clearRect(0,0,w,h);
  ctx.beginPath();
  prices.forEach((p,i)=>{
    const x=i*(w/(prices.length-1));
    const y=h-(p-min)/(max-min)*h;
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.strokeStyle='#2980b9'; ctx.lineWidth=2; ctx.stroke();
}

// Estimate sentiment
function estimateSentiment(name){
  const lower=name.toLowerCase();
  if(/bull|moon|pump|rally|gain|up/i.test(lower)) return {label:'Bullish',class:'positive',icon:'â–²'};
  if(/bear|dump|crash|down|loss/i.test(lower)) return {label:'Bearish',class:'negative',icon:'â–¼'};
  return {label:'Neutral',class:'neutral',icon:'â—'};
}

// Sort coins
function sortByChange(coins){
  const top = coins.filter(c=>c.price_change_percentage_24h>0).sort((a,b)=>b.price_change_percentage_24h-a.price_change_percentage_24h);
  const bottom = coins.filter(c=>c.price_change_percentage_24h<0).sort((a,b)=>a.price_change_percentage_24h-b.price_change_percentage_24h);
  return {top,bottom};
}

// Coin card
function cardHtml(c){
  const change=c.price_change_percentage_24h||0;
  return `
  <div class="card">
    <h3>${c.name} (${c.symbol.toUpperCase()})</h3>
    <div class="meta">Price: $${c.current_price?.toLocaleString()||'N/A'}</div>
    <div class="meta">24h Change: <span class="${change>=0?'positive':'negative'}">${change.toFixed(2)}%</span></div>
    <div class="meta">Market Cap: $${c.market_cap?.toLocaleString()||'N/A'}</div>
    <canvas id="spark-${c.id}"></canvas>
    <a href="https://www.coingecko.com/en/coins/${c.id}" target="_blank">Details</a>
  </div>`;
}

// ======== FETCH & RENDER ========

// Fetch from Cloudflare Worker
async function fetchWorkerData() {
  try {
    const res = await fetch(WORKER_URL);
    const data = await res.json();
    return data.tweets || [];
  } catch(e){ console.error(e); return []; }
}

// Render X Trends (tweets)
function renderXTrends(tweets){
  if(!tweets.length) return '<div class="section"><h2>ðŸ”º X Trends</h2><p>No data.</p></div>';
  return `
  <div class="section"><h2>ðŸ”º X Trends (crypto / finance)</h2>
    <div class="grid">${tweets.map(t=>{
      const s=estimateSentiment(t.text || t.name || '');
      return `<div class="card">
        <h3>${s.icon} ${t.text||t.name}</h3>
        <div class="meta ${s.class}">Sentiment: ${s.label}</div>
      </div>`;
    }).join('')}</div>
  </div>`;
}

// Render chain section
function renderChainSection(chainKey, tweets){
  const chain = CHAINS[chainKey];
  const filtered = tweets.filter(t=>{
    const text = t.text?.toUpperCase()||'';
    return chain.symbols.some(s=>text.includes(s));
  });

  if(!filtered.length) return `<div class="section"><h2>${chain.name} Tweets</h2><p>No data.</p></div>`;

  return `
  <div class="section"><h2>${chain.name} Tweets</h2>
    <div class="grid">${filtered.map(t=>{
      const s=estimateSentiment(t.text);
      return `<div class="card">
        <h3>${s.icon} ${t.text}</h3>
        <div class="meta ${s.class}">Sentiment: ${s.label}</div>
      </div>`;
    }).join('')}</div>
  </div>`;
}

// Load section
async function loadSection(section){
  const main = document.getElementById('main');
  main.innerHTML='<p>Loading...</p>';
  const tweets = await fetchWorkerData();

  if(section==='news'){
    main.innerHTML = '<div class="section"><h2>ðŸ“° News</h2><p>News feed not configured yet.</p></div>';
  }
  else if(section==='xtrends'){
    main.innerHTML = renderXTrends(tweets);
  }
  else if(CHAINS[section]){
    main.innerHTML = renderChainSection(section, tweets);
  }
  currentSection = section;
}

// Sidebar click
document.querySelectorAll('#sidebar li').forEach(li=>{
  li.addEventListener('click', e=>{
    loadSection(e.target.getAttribute('data-section'));
  });
});

// Default load
window.addEventListener('load',()=>loadSection('news'));

// Auto-refresh every 12h
setInterval(()=>loadSection(currentSection), 12*60*60*1000);

</script>
</body>
</html>
