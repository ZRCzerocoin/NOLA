<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Markets Dashboard</title>
<style>
  :root{
    --purple-start:#8a5cff;
    --purple-end:#5ac6ff;
    --bg-1:#05050a;
    --glass: rgba(10,10,20,0.45);
    --muted: rgba(255,255,255,0.65);
    --card-border: rgba(255,255,255,0.06);
    --accent-glow: rgba(138,92,255,0.14);
    --success: #2ecc71;
    --danger: #ff6b6b;
  }
  html,body{height:100%;margin:0;background:radial-gradient(1200px 600px at 10% 10%, rgba(138,92,255,0.05), transparent), linear-gradient(180deg,var(--bg-1),#060511);font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;color:#fff;}
  .wrap{max-width:1200px;margin:28px auto;padding:20px;display:grid;grid-template-columns:1fr;gap:22px;align-items:start;}
  .panel{border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid var(--card-border);backdrop-filter: blur(8px);padding:14px;box-shadow: 0 6px 30px var(--accent-glow);}
  .list-title{font-size:13px;color:var(--muted);margin-bottom:8px}
  .list {display:flex;flex-direction:column;gap:8px;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid var(--card-border);min-height:140px}
  .coin-row{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;transition:transform .12s}
  .coin-row:hover{transform:translateY(-4px)}
  .coin-icon{width:36px;height:36px;border-radius:8px;display:grid;place-items:center;overflow:hidden;flex-shrink:0}
  .meta{display:flex;flex-direction:column;gap:2px;flex:1}
  .nm{font-weight:700}
  .sym{font-size:12px;color:var(--muted)}
  .stats{margin-left:auto;text-align:right;display:flex;flex-direction:column;gap:2px}
  .stat-price{font-weight:700}
  .stat-change{font-size:13px}
  .green{color:var(--success)}
  .red{color:var(--danger)}
  .copy-btn{margin-left:6px;font-size:10px;padding:2px 4px;border-radius:4px;background:var(--purple-start);color:#fff;cursor:pointer}
  .loader{width:18px;height:18px;border-radius:50%;border:3px solid rgba(255,255,255,0.06);border-top-color:var(--purple-start);animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel" id="global-volume-card">
    <div class="list-title">Global 24h Crypto Volume</div>
    <div id="global-volume"> <div class="loader"></div> </div>
  </div>

  <div class="panel" id="volume-24h-section">
    <div class="list-title">24h Volume Leaders</div>
    <div class="list" id="volumes"> <div class="loader"></div> </div>
  </div>

  <div class="panel" id="top-movers-section">
    <div class="list-title">Top Movers (24h)</div>
    <div class="list" id="movers"> <div class="loader"></div> </div>
  </div>

  <div class="panel" id="top-gainers-section">
    <div class="list-title">Top Gainers (24h)</div>
    <div class="list" id="gainers"> <div class="loader"></div> </div>
  </div>

  <div class="panel" id="top-losers-section">
    <div class="list-title">Top Losers (24h)</div>
    <div class="list" id="losers"> <div class="loader"></div> </div>
  </div>
</div>

<script>
const COINGECKO_MARKETS = 'https://api.coingecko.com/api/v3/coins/markets';
const VS_CURRENCY = 'usd';
const REFRESH_GLOBAL_MS = 2*60*60*1000; // 2 hours
const REFRESH_SECTION_MS = 6*60*1000; // 6 minutes
nolaCache = {};

function el(tag, cls='', html=''){ const e = document.createElement(tag); if(cls) e.className=cls; if(html!==undefined)e.innerHTML=html; return e;}
function formatUsd(v){ return v? '$'+Number(v).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}):'—';}
function formatPct(v){ if(v===null||v===undefined) return '—'; const n=Number(v); const sign=n>0?'+':''; return sign+n.toFixed(2)+'%';}

function chainBadge(chain){ const b=el('div','chain-badge',''); if(chain==='ethereum'){ b.style.background='linear-gradient(90deg,#8a5cff,#2ea0ff)'; b.textContent='ETH'; }
else if(chain==='binance-smart-chain'){ b.style.background='linear-gradient(90deg,#f3ba2f,#f9e79f)'; b.style.color='#111'; b.textContent='BSC'; }
else if(chain==='polygon-pos'){ b.style.background='linear-gradient(90deg,#8247e5,#3ad1ff)'; b.textContent='POLY'; }
else{b.style.background='rgba(255,255,255,0.04)'; b.textContent='—';} return b;}

function makeCoinRow(market, chain){
  const row=el('div','coin-row');
  const iconWrap=el('div','coin-icon');
  const img=el('img'); img.src=market.image; img.alt=market.symbol; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover';
  iconWrap.appendChild(img); row.appendChild(iconWrap);
  const meta=el('div','meta'); meta.innerHTML=`<div class='nm'>${market.name}</div><div class='sym'>${market.symbol.toUpperCase()}</div>`;
  const copyBtn=el('div','copy-btn','Copy'); copyBtn.onclick=()=>{navigator.clipboard.writeText(market.id)}; meta.appendChild(copyBtn);
  row.appendChild(meta);
  const stats=el('div','stats'); stats.appendChild(el('div','stat-price',formatUsd(market.current_price)));
  const chgVal=market.price_change_percentage_24h; const chg=el('div','stat-change',formatPct(chgVal)); chg.className+=' '+(chgVal>=0?'green':'red'); stats.appendChild(chg);
  stats.appendChild(el('div','muted','Vol: '+(market.total_volume?Number(market.total_volume).toLocaleString():'—')));
  row.appendChild(stats);
  row.appendChild(chainBadge(chain));
  return row;
}

async function fetchMarkets(){
  const cached=nolaCache['markets'];
  const now=Date.now();
  if(cached && now-cached.time<REFRESH_SECTION_MS) return cached.data;
  const res=await fetch(`${COINGECKO_MARKETS}?vs_currency=${VS_CURRENCY}&order=market_cap_desc&per_page=120&page=1&sparkline=false&price_change_percentage=24h`);
  const data=await res.json();
  nolaCache['markets']={time:now,data};
  return data;
}

async function fetchGlobalVolume(){
  const cached=nolaCache['global'];
  const now=Date.now();
  if(cached && now-cached.time<REFRESH_GLOBAL_MS) return cached.data;
  const res=await fetch(`${COINGECKO_MARKETS}?vs_currency=${VS_CURRENCY}&order=market_cap_desc&per_page=1&page=1&sparkline=false`);
  const data=await res.json();
  nolaCache['global']={time:now,data};
  return data;
}

async function updateSections(){
  const markets=await fetchMarkets();
  const elGainers=document.getElementById('gainers'); elGainers.innerHTML='';
  const elLosers=document.getElementById('losers'); elLosers.innerHTML='';
  const elMovers=document.getElementById('movers'); elMovers.innerHTML='';
  const elVolumes=document.getElementById('volumes'); elVolumes.innerHTML='';

  const withChange=markets.filter(p=>p.price_change_percentage_24h!==null);
  const gainers=withChange.slice().sort((a,b)=>b.price_change_percentage_24h-a.price_change_percentage_24h).slice(0,6);
  const losers=withChange.slice().sort((a,b)=>a.price_change_percentage_24h-b.price_change_percentage_24h).slice(0,6);
  const movers=withChange.slice().sort((a,b)=>Math.abs(b.price_change_percentage_24h)-Math.abs(a.price_change_percentage_24h)).slice(0,6);
  const volumes=markets.slice().sort((a,b)=> (b.total_volume||0)-(a.total_volume||0)).slice(0,6);

  gainers.forEach(m=>elGainers.appendChild(makeCoinRow(m,'other')));
  losers.forEach(m=>elLosers.appendChild(makeCoinRow(m,'other')));
  movers.forEach(m=>elMovers.appendChild(makeCoinRow(m,'other')));
  volumes.forEach(m=>elVolumes.appendChild(makeCoinRow(m,'other')));
}

async function updateGlobal(){
  const data=await fetchGlobalVolume();
  const el=document.getElementById('global-volume'); el.innerHTML='';
  if(data.length){
    const market=data[0];
    const row=makeCoinRow(market,'other');
    el.appendChild(row);
  } else el.innerHTML='<div class="muted">No data available</div>';
}

updateSections();
updateGlobal();
setInterval(updateSections, REFRESH_SECTION_MS);
setInterval(updateGlobal, REFRESH_GLOBAL_MS);
</script>
</body>
</html>
