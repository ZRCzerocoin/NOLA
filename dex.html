<!-- Complete NOLA Exchange — Full HTML with electric pill + wallet behavior -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NOLA Exchange — Full</title>
<style>
/* ===== RESET & THEME ===== */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Arial',sans-serif}
body{overflow-x:hidden;background:radial-gradient(circle at center,#0c0014,#1a002b 80%);color:#fff;min-height:100vh}
:root{--accent-1:#b445ff;--accent-2:#7013ff;--glass:rgba(255,255,255,0.05);--glass-2:rgba(255,255,255,0.03);--suggest-bg:rgba(25,0,50,0.98);--shadow:0 0 25px rgba(180,0,255,0.3);--container-max:520px}

.container{width:92%;max-width:var(--container-max);margin:36px auto;background:var(--glass);border:1px solid rgba(255,255,255,0.06);border-radius:20px;padding:20px;backdrop-filter:blur(16px);box-shadow:var(--shadow)}
h2{text-align:center;font-size:22px;margin-bottom:12px;color:#e0b3ff}

/* ===== THIN BARS (FROM / TO) ===== */
.input-row{display:flex;gap:12px;align-items:flex-start}
.input-box{flex:1;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);border-radius:12px;padding:10px;display:flex;flex-direction:column;gap:8px}
.row-header{display:flex;align-items:center;justify-content:space-between;gap:8px}
.icon-wrap{display:flex;align-items:center;gap:8px}
.token-icon{width:30px;height:30px;border-radius:8px;object-fit:cover;border:1px solid rgba(0,0,0,0.25)}
.token-symbol{font-weight:800}
.label-muted{opacity:0.75;font-size:13px}

/* input fields */
.input-field{display:flex;gap:8px;align-items:center}
.input-field input[type="number"],.input-field input[type="text"]{flex:1;padding:12px;border-radius:10px;border:none;background:transparent;color:#fff;font-size:15px}
.input-amount{min-width:140px}

/* ===== PRICE AREA — professional layout ===== */
.price-box{display:flex;flex-direction:column;align-items:flex-end;gap:2px}
.price-main{font-size:13px;font-weight:800;opacity:0.95}
.price-sub{font-size:12px;opacity:0.65}

/* suggestions */
.suggestions{background:var(--suggest-bg);border-radius:10px;padding:6px;max-height:260px;overflow:auto;box-shadow:0 8px 30px rgba(0,0,0,0.45);margin-top:6px}
.suggestion-item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px}
.suggestion-item:hover{background:linear-gradient(90deg,rgba(180,68,255,0.04),rgba(112,19,255,0.02));cursor:pointer}
.suggestion-item img{width:28px;height:28px;border-radius:6px;object-fit:cover}
.suggestion-main{display:flex;flex-direction:column}
.suggestion-symbol{font-weight:800}
.suggestion-name{font-size:13px;opacity:0.8}

/* ===== ELECTRIC PILL BUTTON (Swap) ===== */
.swap-row{display:flex;gap:12px;align-items:center;margin-top:12px}
.electric-btn{border:0;background:transparent;padding:0;cursor:pointer}
.electric-pill{position:relative;display:inline-flex;align-items:center;gap:12px;padding:12px 26px;border-radius:999px;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));box-shadow:0 12px 36px rgba(180,68,255,0.18);color:#fff;font-weight:800;font-size:15px;border:none;overflow:hidden;transition:transform .12s ease,box-shadow .12s ease}
.electric-pill .sweep{position:absolute;left:-30%;top:-10%;width:40%;height:120%;background:linear-gradient(90deg,rgba(255,255,255,0.6),rgba(255,255,255,0.12),rgba(255,255,255,0.02));transform:skewX(-18deg);opacity:0.12;filter:blur(10px);border-radius:12px;animation:slideSweep 2.1s linear infinite}
@keyframes slideSweep{0%{transform:translateX(-160%) skewX(-18deg)}50%{transform:translateX(120%) skewX(-18deg)}100%{transform:translateX(360%) skewX(-18deg)}}
.electric-pill .icon{width:28px;height:28px;border-radius:999px;background:rgba(255,255,255,0.08);display:inline-flex;align-items:center;justify-content:center;box-shadow:inset 0 -4px 8px rgba(0,0,0,0.18)}
.electric-pill.connected{box-shadow:0 20px 60px rgba(180,68,255,0.28),0 0 60px rgba(180,68,255,0.12);transform:translateY(-2px)}
.electric-pill.connected .icon{background:linear-gradient(180deg,#fff,#f5e7ff);color:#3b0066}

/* wallet-connect button styled as electric small */
.connect-floating{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#fff;padding:10px 14px;border-radius:12px;border:none;cursor:pointer;font-weight:800;box-shadow:0 10px 30px rgba(106,0,255,0.12)}
.connect-floating.small{padding:8px 10px;font-size:14px}

/* responsive */
@media(max-width:720px){.container{margin:12px;padding:16px}.token-icon{width:26px;height:26px}.input-amount{min-width:120px}}
</style>
</head>
<body>

<div class="container" role="main" aria-label="NOLA Exchange">
  <h2>NOLA Exchange</h2>

  <!-- FROM row -->
  <div class="input-row">
    <div class="input-box" id="fromBox">
      <div class="row-header">
        <div class="icon-wrap">
          <img id="fromIcon" class="token-icon" src="" alt="from logo">
          <div class="token-symbol" id="fromSymbol">—</div>
        </div>
        <div class="label-muted">From</div>
      </div>

      <div class="input-field">
        <input id="fromToken" type="text" placeholder="Token symbol or contract (paste address too)" />
        <div class="input-amount"><input id="fromAmount" type="number" placeholder="Amount" step="any"></div>
      </div>

      <div class="price-box">
        <div id="fromPriceMain" class="price-main">—</div>
        <div id="fromPriceSub" class="price-sub">per unit</div>
      </div>

      <div class="suggestions" id="fromSuggestions" style="display:none"></div>
    </div>

    <!-- Swap button (electric pill) placed between boxes on wide screens -->
    <div class="swap-row">
      <button id="swapBtnOutside" class="electric-btn" title="Swap">
        <span id="swapPill" class="electric-pill" aria-pressed="false">
          <span class="sweep" aria-hidden="true"></span>
          <span class="icon">⇄</span>
          <span class="label">Swap</span>
        </span>
      </button>
    </div>
  </div>

  <!-- TO row -->
  <div class="input-row" style="margin-top:12px">
    <div class="input-box" id="toBox">
      <div class="row-header">
        <div class="icon-wrap">
          <img id="toIcon" class="token-icon" src="" alt="to logo">
          <div class="token-symbol" id="toSymbol">—</div>
        </div>
        <div class="label-muted">To</div>
      </div>

      <div class="input-field">
        <input id="toToken" type="text" placeholder="Token symbol or contract (paste address too)" />
        <div class="input-amount"><input id="toEstimate" type="text" placeholder="Estimate" readonly></div>
      </div>

      <div class="price-box">
        <div id="toPriceMain" class="price-main">—</div>
        <div id="toPriceSub" class="price-sub">per unit</div>
      </div>

      <div class="suggestions" id="toSuggestions" style="display:none"></div>
    </div>
  </div>

  <!-- Controls: slippage + connect -->
  <div style="display:flex;gap:12px;align-items:center;margin-top:14px">
    <select id="slippage" class="connect-floating small" title="Select slippage">
      <option value="0.1">0.1%</option><option value="0.5">0.5%</option><option value="1" selected>1%</option><option value="2">2%</option><option value="custom">Custom</option>
    </select>

    <button id="connectFloating" class="connect-floating">Connect Wallet</button>
  </div>

  <div style="margin-top:16px;display:flex;gap:12px;align-items:center">
    <button id="swapBtn" class="electric-btn">
      <span id="swapPillMain" class="electric-pill" aria-pressed="false">
        <span class="sweep" aria-hidden="true"></span>
        <span class="icon">⇄</span>
        <span class="label">Swap</span>
      </span>
    </button>
    <div id="statusMsg" style="opacity:0.85;font-size:13px">Not connected</div>
  </div>

</div>

<!-- LIBS -->
<script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
<script src="https://unpkg.com/@web3modal/html@2.1.1/dist/index.js"></script>
<script src="https://unpkg.com/@walletconnect/web3modal@2.6.4/dist/w3m.min.js"></script>

<script>
/* ================= CONFIG & STATE ================= */
const fallbackBase = 'https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/128/color/';
const COINGECKO_IMAGE_BASE = 'https://assets.coingecko.com/coins/images'; // we'll build path per symbol heuristically
let provider=null, signer=null, userAddress=null, web3modal=null;

/* helper to try coingecko then fallback */
function getCoingeckoImageForSymbol(symbol){
  // Coingecko doesn't provide a straight symbol→image mapping by predictable path.
  // We'll try a few heuristics: popular tokens have known ids; otherwise rely on token list logoURI in a full app.
  const map = {BTC:'/1/large/1.png',ETH:'/279/large/ethereum.png',SOL:'/4128/large/solana.png',USDC:'/6319/large/usdc.png'};
  const key = symbol.toUpperCase();
  if(map[key]) return 'https://assets.coingecko.com' + map[key];
  // fallback: attempt a generic path (likely to 404) and let onerror fallback to repo icon
  return `https://assets.coingecko.com/coins/images/1/large/${symbol.toLowerCase()}.png`;
}

function setTokenIcon(elId, symbol){
  const img = document.getElementById(elId);
  const cg = getCoingeckoImageForSymbol(symbol);
  img.src = cg;
  img.onerror = function(){ this.onerror=null; this.src = `${fallbackBase}${symbol.toLowerCase()}.png`; }
}

/* UI helpers to toggle connected state */
function setConnectedUI(address){
  document.getElementById('statusMsg').textContent = address ? (`Connected ${address.slice(0,6)}…${address.slice(-4)}`) : 'Not connected';
  const pills = document.querySelectorAll('.electric-pill');
  pills.forEach(p => { if(address) p.classList.add('connected'); else p.classList.remove('connected'); });
}

/* Wallet connection logic: try MetaMask -> Web3Modal -> deep links on mobile */
async function initWeb3Modal(){
  try{
    web3modal = new window.WalletConnectWeb3Modal.default({ projectId: '6557a92e3698182727669d41cbeb95a1', themeMode: 'dark' });
  }catch(e){ console.warn('web3modal init failed', e); web3modal=null; }
}
initWeb3Modal();

async function connectWallet(autoDeepLink=true){
  try{
    // MetaMask in browser
    if(window.ethereum && window.ethereum.isMetaMask){
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send('eth_requestAccounts', []);
      signer = provider.getSigner();
      userAddress = await signer.getAddress();
      setConnectedUI(userAddress);
      return true;
    }

    // try web3modal (WalletConnect or other mobile connectors)
    if(web3modal){
      const modal = await web3modal.openModal();
      if(!modal) return false;
      provider = new ethers.providers.Web3Provider(modal);
      signer = provider.getSigner();
      userAddress = await signer.getAddress();
      setConnectedUI(userAddress);
      return true;
    }

    // if on mobile, attempt to deep link common wallets
    if(autoDeepLink && /Mobi|Android|iPhone/i.test(navigator.userAgent)){
      // try to open MetaMask app, then Trust, then Rainbow (best-effort)
      const links = [
        'metamask://',
        'trust://',
        'rainbow://',
        'wc:' // WalletConnect deep link doesn’t open directly without payload but try
      ];
      for(const l of links){
        try{ window.location = l; return true;}catch(e){}
      }
    }

    alert('No in-browser wallet found and web3modal not available. Install a mobile wallet app (MetaMask, Trust) or use a supported browser.');
    return false;
  }catch(e){
    console.error('connectWallet error', e);
    try{ setConnectedUI(null); }catch(_){}
    return false;
  }
}

/* attach connect button */
document.getElementById('connectFloating').addEventListener('click', ()=> connectWallet(true));

/* Swap button behavior: lights only when connected */
const swapBtnMain = document.getElementById('swapBtn');
swapBtnMain.addEventListener('click', ()=>{
  if(!userAddress){ alert('Please connect your wallet first.'); return; }
  alert('Swap action placeholder — implement on-chain swap logic.');
});

// Outside swap pill
document.getElementById('swapBtnOutside').addEventListener('click', ()=>{
  if(!userAddress){ alert('Please connect your wallet first.'); return; }
  alert('Swap (outside) placeholder — implement swap execution.');
});

/* Example suggestions and icon usage (Coingecko primary -> fallback) */
const sample = [
  {symbol:'BTC',name:'Bitcoin'},
  {symbol:'ETH',name:'Ethereum'},
  {symbol:'SOL',name:'Solana'},
  {symbol:'USDC',name:'USD Coin'}
];

function renderSuggestions(){
  const fromBox = document.getElementById('fromSuggestions');
  fromBox.innerHTML = '';
  sample.forEach(t=>{
    const row = document.createElement('div'); row.className='suggestion-item';
    const img = document.createElement('img'); img.src=getCoingeckoImageForSymbol(t.symbol);
    img.onerror=function(){ this.onerror=null; this.src=`${fallbackBase}${t.symbol.toLowerCase()}.png`; }
    const main = document.createElement('div'); main.className='suggestion-main';
    const sym = document.createElement('div'); sym.className='suggestion-symbol'; sym.textContent=t.symbol;
    const nm = document.createElement('div'); nm.className='suggestion-name'; nm.textContent=t.name;
    main.appendChild(sym); main.appendChild(nm);
    row.appendChild(img); row.appendChild(main);
    row.addEventListener('click', ()=>{ applyTokenSelection('from', t); fromBox.style.display='none'; });
    fromBox.appendChild(row);
  });
}

function applyTokenSelection(side, tok){
  if(side==='from'){
    document.getElementById('fromSymbol').textContent = tok.symbol;
    setTokenIcon('fromIcon', tok.symbol);
    document.getElementById('fromAmount').placeholder = 'Amount ('+tok.symbol+')';
    document.getElementById('fromPriceMain').textContent = '$0.00';
    document.getElementById('fromPriceSub').textContent = 'per '+tok.symbol;
  } else {
    document.getElementById('toSymbol').textContent = tok.symbol;
    setTokenIcon('toIcon', tok.symbol);
  }
}

// wire input focus to show suggestions for demo
document.getElementById('fromToken').addEventListener('focus', ()=>{ const b=document.getElementById('fromSuggestions'); b.style.display='block'; renderSuggestions(); });

document.getElementById('toToken').addEventListener('focus', ()=>{ const b=document.getElementById('toSuggestions'); b.style.display='block'; /* reuse same list */ b.innerHTML=document.getElementById('fromSuggestions').innerHTML; });

/* On load: prefill common icons */
setTokenIcon('fromIcon','BTC'); document.getElementById('fromSymbol').textContent='BTC';
setTokenIcon('toIcon','ETH'); document.getElementById('toSymbol').textContent='ETH';
setConnectedUI(null);
</script>

</body>
</html>
