<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NOLA Exchange</title>
<style>
/* ===== RESET ===== */
* {margin:0; padding:0; box-sizing:border-box; font-family:'Arial',sans-serif;}
body {overflow-x:hidden; background: radial-gradient(circle at center, #0c0014, #1a002b 80%); color:#fff; scroll-behavior:smooth;}

/* ===== PARTICLES ===== */
body::before { content:''; position:fixed; width:200%; height:200%; background: radial-gradient(circle, rgba(150,0,255,0.2), transparent 60%); animation: nebulaMove 20s infinite alternate ease-in-out; z-index:-2;}
@keyframes nebulaMove {0% {transform: translate(-10%,-10%);} 100% {transform: translate(5%,5%);} }
.particle { position:absolute; width:2px; height:2px; background:#b445ff; border-radius:50%; opacity:0.8; animation: floatParticle linear infinite;}
@keyframes floatParticle {0%{transform:translateY(0) translateX(0);opacity:0.8;}50%{transform:translateY(-50px) translateX(20px);opacity:0.4;}100%{transform:translateY(0) translateX(0);opacity:0.8;}}

/* ===== LOGO ===== */
.logo { width:150px; display:block; margin:25px auto; animation: logoGlow 5s ease-in-out infinite alternate, logoRotate 30s linear infinite;}
@keyframes logoGlow {0%{filter:drop-shadow(0 0 15px #9c00ff);}50%{filter:drop-shadow(0 0 35px #d15fff);}100%{filter:drop-shadow(0 0 15px #9c00ff);}}
@keyframes logoRotate {0%{transform:rotateY(0deg);}100%{transform:rotateY(360deg);}}

/* ===== CARD ===== */
.container { width:90%; max-width:480px; margin:40px auto; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:25px; padding:25px; backdrop-filter:blur(18px); box-shadow:0 0 25px rgba(180,0,255,0.3); animation:cardIn 1s ease; perspective:1000px;}
@keyframes cardIn {from{opacity:0; transform:translateY(30px);}to{opacity:1; transform:translateY(0);}}
h2{text-align:center; font-size:28px; font-weight:600; margin-bottom:15px; color:#e0b3ff; text-shadow:0 0 8px #b445ff;}

/* ===== INPUT ===== */
.input-box { margin-top:20px; padding:15px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:16px; box-shadow:0 0 15px rgba(150,0,255,0.15); transition:0.3s; position:relative; }
.input-box:hover{box-shadow:0 0 30px rgba(180,0,255,0.35); transform:translateY(-3px);}
.input-box input{width:100%; padding:12px; border-radius:12px; border:none; background:rgba(255,255,255,0.05); color:#fff; font-size:16px;}
.input-box p{font-size:14px; opacity:0.8; margin-bottom:8px;}

/* ===== TOKEN SUGGESTIONS ===== */
.suggestions { position:absolute; top:65px; left:0; width:100%; background:rgba(25,0,50,0.95); border-radius:12px; max-height:200px; overflow-y:auto; display:none; z-index:100; }
.suggestion-item { padding:10px; display:flex; align-items:center; cursor:pointer; transition:0.2s; }
.suggestion-item:hover { background:rgba(120,0,255,0.3); }
.suggestion-item img { width:24px; height:24px; margin-right:10px; border-radius:12px; }

/* ===== BUTTON ===== */
.btn { width:100%; padding:14px; margin-top:20px; border:none; border-radius:20px; background: linear-gradient(135deg,#b445ff,#7013ff); color:#fff; font-size:18px; cursor:pointer; box-shadow:0 0 15px rgba(180,0,255,0.35); transition:0.3s; position:relative; overflow:hidden;}
.btn::after { content:''; position:absolute; left:50%; top:50%; width:300%; height:300%; background:rgba(255,255,255,0.1); transform:translate(-50%,-50%) scale(0); border-radius:50%; transition:0.5s; }
.btn:hover::after { transform:translate(-50%,-50%) scale(1); }
.btn:hover { transform:scale(1.05); box-shadow:0 0 25px rgba(200,0,255,0.55); }

/* ===== PORTFOLIO ===== */
.portfolio { margin-top:30px; background:rgba(255,255,255,0.05); border-radius:20px; padding:15px; box-shadow:0 0 15px rgba(150,0,255,0.15);}
.portfolio-item{display:flex; align-items:center; margin-bottom:10px;}
.portfolio-item img{width:28px; height:28px; margin-right:10px; border-radius:14px;}
.portfolio-item span{flex:1;}

/* ===== LAUNCH TOOLS ===== */
.launch-tools {margin-top:30px; padding:15px; border-radius:20px; background:rgba(255,255,255,0.05); box-shadow:0 0 15px rgba(150,0,255,0.15);}

/* ===== CHAT SIDEBAR ===== */
.chat-toggle { position:fixed; right:20px; bottom:20px; background:#b445ff; padding:10px 14px; border-radius:20px; cursor:pointer; box-shadow:0 0 15px rgba(180,0,255,0.35); }
.chat-sidebar { position:fixed; right:20px; bottom:60px; width:300px; max-height:500px; background:rgba(0,0,0,0.3); backdrop-filter:blur(10px); border-radius:20px; padding:15px; overflow-y:auto; display:none; flex-direction:column;}
.chat-msg { margin-bottom:10px; padding:8px; border-radius:12px; font-size:14px; word-break:break-word; }
.chat-input { display:flex; margin-top:10px; }
.chat-input input{flex:1; padding:8px 10px; border-radius:12px; border:none; background:rgba(255,255,255,0.05); color:#fff;}
.chat-input button{margin-left:5px; padding:8px 12px; border-radius:12px; border:none; background:#b445ff; cursor:pointer;}
</style>
</head>
<body>

<!-- PARTICLES -->
<script>
for(let i=0;i<60;i++){
    let particle=document.createElement('div');
    particle.className='particle';
    particle.style.top=Math.random()*100+'%';
    particle.style.left=Math.random()*100+'%';
    particle.style.width=(Math.random()*3+1)+'px';
    particle.style.height=(Math.random()*3+1)+'px';
    particle.style.animationDuration=(Math.random()*10+5)+'s';
    document.body.appendChild(particle);
}
</script>

<!-- LOGO -->
<img src="nol.png" class="logo">

<!-- MAIN CARD -->
<div class="container">
    <h2>NOLA Exchange</h2>

    <div class="input-box">
        <p>From Token</p>
        <input type="text" id="fromToken" placeholder="Type token name...">
        <div class="suggestions" id="fromSuggestions"></div>
    </div>

    <div class="input-box">
        <p>To Token</p>
        <input type="text" id="toToken" placeholder="Type token name...">
        <div class="suggestions" id="toSuggestions"></div>
    </div>

    <button class="btn" id="connectWalletBtn">Connect Wallet</button>

    <div class="portfolio" id="portfolio">
        <h3 style="text-align:center; margin-bottom:10px;">Portfolio</h3>
    </div>

    <div class="launch-tools">
        <h3>Launch Tools</h3>
        <p>Manage your tokens & liquidity pools here.</p>
    </div>
</div>

<!-- CHAT TOGGLE -->
<div class="chat-toggle" id="chatToggle">ðŸ’¬ Chat</div>

<!-- CHAT SIDEBAR -->
<div class="chat-sidebar" id="chatSidebar">
    <h3 style="text-align:center;">Public Chat</h3>
    <div id="chatMessages" style="flex:1; overflow-y:auto;"></div>
    <div class="chat-input">
        <input type="text" id="chatInput" placeholder="Type message...">
        <button id="sendChat">Send</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
<script>
/* ===== PARTICLES DONE ABOVE ===== */

/* ===== TOKEN LIST ===== */
let tokenList=[];
fetch('https://api.1inch.io/v5.0/137/tokens')
.then(res=>res.json())
.then(data=>{ tokenList = Object.values(data.tokens); });

function setupAutocomplete(inputId, suggestionsId){
    const input = document.getElementById(inputId);
    const suggestionsBox = document.getElementById(suggestionsId);
    input.addEventListener('input',()=>{
        const val = input.value.toLowerCase();
        suggestionsBox.innerHTML='';
        if(!val) { suggestionsBox.style.display='none'; return; }
        const filtered = tokenList.filter(t => t.symbol.toLowerCase().includes(val) || t.name.toLowerCase().includes(val)).slice(0,6);
        filtered.forEach(token=>{
            const div=document.createElement('div');
            div.className='suggestion-item';
            div.innerHTML=`<img src="${token.logoURI}" alt="${token.symbol}"><span>${token.symbol} - ${token.name}</span>`;
            div.onclick=()=>{ input.value=token.symbol; suggestionsBox.style.display='none'; updatePortfolio(); };
            suggestionsBox.appendChild(div);
        });
        suggestionsBox.style.display = filtered.length?'block':'none';
    });
}
setupAutocomplete('fromToken','fromSuggestions');
setupAutocomplete('toToken','toSuggestions');

/* ===== WALLET + PORTFOLIO ===== */
let provider;
document.getElementById('connectWalletBtn').onclick = async ()=>{
    if(window.ethereum){
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        updatePortfolio();
    } else { alert('Please install MetaMask!'); }
}

async function updatePortfolio(){
    if(!provider) return;
    const signer = provider.getSigner();
    const address = await signer.getAddress();
    const portfolioDiv = document.getElementById('portfolio');
    portfolioDiv.innerHTML='<h3 style="text-align:center; margin-bottom:10px;">Portfolio</h3>';
    tokenList.slice(0,10).forEach(async token=>{
        try{
            const tokenContract = new ethers.Contract(token.address, ["function balanceOf(address) view returns(uint256)","function decimals() view returns(uint8)"], provider);
            const balance = await tokenContract.balanceOf(address);
            const decimals = await tokenContract.decimals();
            const usdValue = (balance / Math.pow(10,decimals) * 1).toFixed(2);
            const div = document.createElement('div');
            div.className='portfolio-item';
            div.innerHTML=`<img src="${token.logoURI}"><span>${(balance / Math.pow(10,decimals)).toFixed(4)} ${token.symbol}</span><span>$${usdValue}</span>`;
            portfolioDiv.appendChild(div);
        }catch(e){ }
    });
}

/* ===== CHAT ===== */
const chatToggle = document.getElementById('chatToggle');
const chatSidebar = document.getElementById('chatSidebar');
chatToggle.onclick = ()=>{ chatSidebar.style.display = (chatSidebar.style.display==='flex')?'none':'flex'; }

const gun = Gun(); // public chat
let username;
const userColors = {};
function getColor(name){ if(userColors[name]) return userColors[name]; let color = '#'+Math.floor(Math.random()*16777215).toString(16); userColors[name]=color; return color; }

document.getElementById('sendChat').onclick = ()=>{
    if(!username) username = prompt("Enter your chat username ðŸŒŒ") || "Anon";
    const msgInput = document.getElementById('chatInput');
    if(!msgInput.value) return;
    const msgObj = {user:username, text:msgInput.value, color:getColor(username)};
    gun.get('nolaChat').set(msgObj);
    msgInput.value='';
}

// listen for messages
gun.get('nolaChat').map().on(msg=>{
    if(!msg.user || !msg.text) return;
    const chatMessages = document.getElementById('chatMessages');
    const div = document.createElement('div');
    div.className='chat-msg';
    div.style.background = msg.color+'33';
    div.innerHTML=`<b style="color:${msg.color}">${msg.user}:</b> ${msg.text}`;
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
});
</script>

</body>
</html>
