<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NOLA Exchange</title>

<style>
/* GLOBAL THEME (unchanged) */
html, body {
    height: 100%;
    margin: 0;
}
body {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    background: radial-gradient(circle at center, #0c0014, #1a002b 80%);
    color: #fff;
    font-family: Arial, sans-serif;
    overflow-x: hidden;
}

/* Main card */
.container {
    width: 90%;
    max-width: 480px;
    background: rgba(255,255,255,0.05);
    border-radius: 25px;
    padding: 25px;
    backdrop-filter: blur(18px);
    box-shadow: 0 0 25px rgba(180,0,255,0.3);
}

/* Logo animation at top */
#logoTop {
    width: 120px;
    margin-bottom: 20px;
    animation: float 3s ease-in-out infinite;
}
@keyframes float {
    0% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
    100% { transform: translateY(0); }
}

/* Headline */
h2 {
    text-align: center;
    color: #e0b3ff;
    text-shadow: 0 0 8px #b445ff;
}

/* Bar container */
.input-box {
    margin-top: 18px;
    padding: 12px;
    background: rgba(255,255,255,0.02);
    border-radius: 16px;
    position: relative;
}

/* Layout inside bars */
.token-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
}

.token-left {
    display: flex;
    align-items: center;
    gap: 10px;
    overflow: hidden;
    min-width: 140px;
}

/* Token icons hidden by default */
.token-left img {
    width: 30px;
    height: 30px;
    border-radius: 10px;
    object-fit: cover;
    flex-shrink: 0;
    display: none;
}

.token-left input {
    border: none;
    background: transparent;
    color: #fff;
    font-weight: 700;
    font-size: 16px;
    outline: none;
    width: 100%;
}

.token-right {
    display: flex;
    align-items: center;
    gap: 10px;
}

.amount {
    padding: 8px 10px;
    border-radius: 12px;
    background: rgba(255,255,255,0.03);
    border: none;
    color: #fff;
    font-size: 16px;
    width: 110px;
    text-align: right;
}

.usd {
    font-size: 13px;
    opacity: 0.9;
    min-width: 80px;
    text-align: right;
}

/* Suggestions list */
.suggestions {
    position: absolute;
    top: 70px;
    left: 0;
    width: 100%;
    background: rgba(25,0,50,0.95);
    border-radius: 12px;
    max-height: 240px;
    overflow-y: auto;
    display: none;
    z-index: 100;
}

.suggestion-item {
    padding: 10px;
    display: flex;
    align-items: center;
    cursor: pointer;
    justify-content: space-between;
}

.suggestion-left {
    display: flex;
    gap: 10px;
    align-items: center;
}
.suggestion-left img {
    width: 28px;
    height: 28px;
    border-radius: 8px;
    object-fit: cover;
}

.suggestion-symbol { font-weight: 700; font-size: 14px; }
.suggestion-name { font-size: 12px; opacity: 0.8; }
.suggestion-price { font-size: 13px; opacity: 0.9; min-width: 88px; text-align: right; }

/* Swap Button */
#swapTokensBtn {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    top: calc(50% - 18px);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(30,20,60,0.8);
    border: 2px solid rgba(255,255,255,0.05);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #fff;
    font-size: 18px;
    z-index: 150;
    transition: transform 0.25s ease;
}

#swapTokensBtn:active {
    transform: translateX(-50%) rotate(180deg);
}

/* Wallet iframe */
#walletFrame {
    position: fixed;
    top: 16px;
    right: 16px;
    border: none;
    background: transparent;
    width: 160px;
    height: 46px;
    z-index: 999;
}

/* Mobile adjustments */
@media (max-width: 420px) {
    .amount { width: 86px; font-size: 14px; }
    .token-left input { font-size: 14px; }
    .token-left img { width: 26px; height: 26px; }
}
</style>
</head>

<body>

<!-- FLOATING TOP LOGO -->
<img id="logoTop" src="logo.gif" alt="logo">

<!-- WALLETCONNECT BUTTON VIA IFRAME -->
<iframe id="walletFrame" src="walletconnect.htm"></iframe>

<!-- MAIN CARD -->
<div class="container">

    <h2>NOLA Exchange</h2>

    <!-- FROM -->
    <div class="input-box" id="fromBox">
        <div class="token-top">
            <div class="token-left">
                <img id="fromLogo" alt="">
                <input id="fromToken" placeholder="From Token" autocomplete="off">
            </div>
            <div class="token-right">
                <input id="fromAmount" class="amount" type="number" placeholder="0" min="0" step="any">
                <div id="fromUsd" class="usd">—</div>
            </div>
        </div>
        <div class="suggestions" id="fromSuggestions"></div>
    </div>

    <!-- SWAP BUTTON -->
    <div id="swapTokensBtn">⇅</div>

    <!-- TO -->
    <div class="input-box" id="toBox" style="margin-top: 14px;">
        <div class="token-top">
            <div class="token-left">
                <img id="toLogo" alt="">
                <input id="toToken" placeholder="To Token" autocomplete="off">
            </div>
            <div class="token-right">
                <input id="toAmount" class="amount" readonly placeholder="0">
                <div id="toUsd" class="usd">—</div>
            </div>
        </div>
        <div class="suggestions" id="toSuggestions"></div>
    </div>

</div>

<script>
/* --------------------------
   PRICE + ESTIMATE REFRESH
---------------------------*/

async function fetchPrice(symbol) {
    if (!symbol) return null;

    try {
        let res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${symbol}&vs_currencies=usd&include_24hr_vol=true`);
        let data = await res.json();
        let key = Object.keys(data)[0];
        return data[key]?.usd || null;
    } catch {
        return null;
    }
}

/* Update USD & Estimates every 7 seconds */
setInterval(updateAllPrices, 7000);

async function updateAllPrices() {
    updateFromPrice();
    updateToPrice();
    updateEstimate();
}

async function updateFromPrice() {
    let s = window.fromSelectedId;
    if (!s) return;
    let p = await fetchPrice(s);
    if (!p) return;
    document.getElementById("fromUsd").textContent = "≈ $" + (p * (Number(fromAmount.value) || 0)).toFixed(4);
}

async function updateToPrice() {
    let s = window.toSelectedId;
    if (!s) return;
    let p = await fetchPrice(s);
    if (!p) return;
    document.getElementById("toUsd").textContent = "≈ $" + p.toFixed(4);
}

/* Basic estimate logic */
async function updateEstimate() {
    if (!window.fromSelectedId || !window.toSelectedId) return;

    let fromPrice = await fetchPrice(window.fromSelectedId);
    let toPrice   = await fetchPrice(window.toSelectedId);

    if (!fromPrice || !toPrice) return;

    let usd = (Number(fromAmount.value) || 0) * fromPrice;
    let est = usd / toPrice;

    document.getElementById("toAmount").value = est ? est.toFixed(6) : "0";
}

/* Trigger updates on input */
fromAmount.oninput = updateAllPrices;

/* Swap button logic */
document.getElementById("swapTokensBtn").onclick = () => {
    let tempId = window.fromSelectedId;
    window.fromSelectedId = window.toSelectedId;
    window.toSelectedId = tempId;

    let tempA = fromToken.value;
    fromToken.value = toToken.value;
    toToken.value = tempA;

    updateAllPrices();
};
</script>

</body>
</html>
